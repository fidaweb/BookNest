<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="bootstrap.min.css" />
    <link rel="stylesheet" href="../style.css" />
    <script src="bootstrap.bundle.min.js.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
      
      body {
            background: url('../assets/images/background.jpg') center/cover no-repeat;
            min-height: 100vh;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: url('../assets/images/background.jpg') center/cover no-repeat;
            filter: blur(5px);
            z-index: -1;
        }

      .card.flip {
        transform: rotateY(360deg);
        transition: transform 0.8s;
      }

      .card {
        transition: transform 0.8s;
        background: transparent;
        height: 25rem;
        color: black;
        /* background: var(--main-background) */
        background-color: rgba(255, 255, 255, 0.3);
       
      }

      h2 {
        width: 20rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .card.author.hid,
      .card.price.hid {
        display: none;
      }
      .desc {
        display: none;
      }
      a {
      text-decoration: none;
      color: black;
    }

      .modal-header {
        background: transparent;
        /* background-color: rgba(255, 255, 255, 0.3); */
        /* background-color: white; */
      }

      #main{
        /* background: rgba(255, 255, 255, 0.9); */
        /* background: linear-gradient(
          0deg,
          rgba(34, 193, 195, 1) 0%,
          rgba(253, 187, 45, 1) 100%
        ); */
        min-height: 100vh;
      
      }

      .footer {
            background: rgba(215, 128, 40, 0.95);
            backdrop-filter: blur(10px);
            color: white;
            padding: 3rem 0 1rem 0;
            margin-top: auto;
        }
        
        .footer h5, .footer h6 {
            color: #fff;
            margin-bottom: 1rem;
        }
        
        .footer ul {
            list-style: none;
            padding: 0;
        }
        
        .footer ul li {
            margin-bottom: 0.5rem;
        }
        
        .footer ul li a {
            color: #fff;
        }
        
        .footer ul li a:hover {
            color: #fff;
        }
        
        
        .payment-logo {
            height: 30px;
            margin-left: 0.5rem;
            opacity: 1;
        }
        .no-session{
          display:none;
        }
        

    </style>
  </head>
  <body>

<!-- Most of the logic of home.html is the same as the other category pages -->
 
    <my-navbar></my-navbar>

    <!--This is the modal for add to cart notification which is almost the same modal as done in class for bootstrap
the addtocart button is attached to function on click event that renders a bootstrap element based on this modal defined below
-->

    <div class="container">
      <div
        aria-labelledby="modtitle"
        aria-hidden="true"
        tabindex="-1"
        class="modal fade"
        id="mymodal"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header rounded border p-">
              <h1 id="modtitle" class="modal-title">Book Added To Cart!</h1>
              <button
                data-bs-dismiss="modal"
                type="button"
                class="btn-close"
              ></button>
            </div>
          </div>
        </div>
      </div>
    </div>



<!--This is the modal for category which is almost the same modal as done in class for bootstrap
the category button is attached to function on click event that renders a bootstrap element based on this modal defined below
-->
    <div
        aria-labelledby="modtitle"
        aria-hidden="true"
        tabindex="-1"
        class="modal fade"
        id="categorymodal"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header rounded border p-">
             <div class="gap-3 d-flex flex-wrap">
              <a class="navbar-link" href="fiction.html">Fiction</a>
              <a class="navbar-link" href="history_politics.html">History & Politics</a>
              <a class="navbar-link" href="educational.html">Educational</a>
              <a class="navbar-link" href="kids.html">Kids</a>
             </div>
              <button
                data-bs-dismiss="modal"
                type="button"
                class="btn-close"
              ></button>
            </div>
          </div>
        </div>
      </div>
    </div>



    <!-- This is the bar that shows the search compnent and buttons to navigate to different pages except the catagory button -->
    <div
      class="d-flex p-3 align-center justify-content-between flex-wrap gap-3" 
    >
      <div class="search align-center ">
        <input  class="search rounded-3" placeholder="Search" style="height: 100%"  type="text" />
        <button class="btn btn-outline-light ">Search</button>
      </div>
      <div>
        <button class="category btn btn-secondary">Category</button>
        <span class="user-nav">
          <button class="cart btn btn-secondary">Cart</button>
        <button class="mybooks btn btn-secondary">My Books</button>
        <button class="mycommunities btn btn-secondary">My Communities</button>
        <button class="logout btn btn-secondary">Logout</button>
        </span>
        <span class="no-session">
          <button class="login btn btn-secondary">Login</button>
        </span>
        
      </div>
      
    </div>
<!-- This is the main container that is initially empty and then populated by cards using javascript below -->
    <div
      id="main"
      class="p-3 gap-5 align-center d-flex justify-content-center flex-wrap"
     
    ></div>
    <div class="d-flex align-center justify-content-center p-3">
      <button class="more btn btn-dark">More...</button>
    </div>
   


<!-- This is the pagination boostrap element taken from the lab manual from boostrap -->

    <!-- <nav
      style="
        align-items: center;
        justify-content: center;
        display: flex;
        padding: 0.5rem;
      "
      aria-label="..."
    >
      <ul class="pagination">
        <li class="page-item disabled">
          <a class="page-link" href="#" tabindex="-1">Previous</a>
        </li>
        <li class="page-item"><a class="page-link" href="#">1</a></li>
        <li class="page-item active">
          <a class="page-link" href="#"
            >2 <span class="sr-only">(current)</span></a
          >
        </li>
        <li class="page-item"><a class="page-link" href="#">3</a></li>
        <li class="page-item">
          <a class="page-link" href="#">Next</a>
        </li>
      </ul>
    </nav> -->

  <!-- This is the footer done by Adline -->
    <footer class="footer">
      <div class="container py-5">
          <div class="row">
              <div class="col-lg-4 mb-4">
                  <h5><i class="fas fa-book"></i> BookNest</h5>
                  <p>Your trusted online bookstore for all genres. Discover, read, and grow with our vast collection of books.</p>
                  <div class="social-links">
                      <a href="https://www.facebook.com/"><i class="fab fa-facebook"></i></a>
                      <a href="https://x.com/?lang=en"><i class="fab fa-twitter"></i></a>
                      <a href="https://www.instagram.com/"><i class="fab fa-instagram"></i></a>
                      <a href="https://www.linkedin.com/"><i class="fab fa-linkedin"></i></a>
                  </div>
              </div>
              <div class="col-lg-1 col-md-6 mb-4">
                  <h6>Quick Links</h6>
                  <ul>
                      <li><a href="#">Home</a></li>
                      <li><a href="#">Books</a></li>
                      <li><a href="#">Categories</a></li>
                      <li><a href="#">Authors</a></li>
                  </ul>
              </div>
              <div class="col-lg-3 col-md-6 mb-4">
                  <h6>Contact Us</h6>
                  <p><span>&#9993</span>Email:booknest@gmail.com</p>
                  <p><span>&#9743</span>Phone: 01824673890</p>
                  <p><span>&#8962</span> Address: Block A Dhaka,Bangladesh</p>
                  
              </div>
              
              
          </div>
          <hr style="border-color: #495057;">
          <div class="row align-items-center">
              <div class="col-md-6">
                  <p class="mb-0">&copy; 2025 BookNest. All rights reserved.</p>
              </div>
              <div class="col-md-6 text-md-end">
                  <img src="../assets/images/visa.jpg" alt="Visa" class="payment-logo">
                  <img src="../assets/images/mastercard.png" alt="Mastercard" class="payment-logo">
                  <img src="../assets/images/bkash.jpg" alt="Bkash" class="payment-logo">
                  <img src="../assets/images/nagad.png" alt="Nagad" class="payment-logo">
                  <img src="../assets/images/upay.png" alt="Upay" class="payment-logo">
              </div>
          </div>
      </div>
  </footer>




    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- This is the javascript imported from my-card.js and navbar.js needed to create a template shadow element that is cloned each time the component is
     used in the project and then append as child element of  the shadow root -->
    <script type="module">
      import "../components/my-card.js";
      import "../components/navbar.js";
    </script>


<!-- this is the load books functions that will fetch from database but currently using a static array for the fetched data -->

    <script>
      function load(count){
        $.get(`../../api/category.php?page=home&offset=${count}`, function (data) {
        //   this is data array representing what will be fetched from database



 //since database echos an array of JSON format objects as string  and send it as data
//JSON.parse parses the string into an array of JSON objects
          const books = JSON.parse(data);
          
          //iterate over the array and for each object get data from object create a card
          //embed the data[url,name,ISBN,Book Title,Author] in the card html element 
          //append or populate the main element with the newly embedded card
          books.forEach((book) => {
            //create my card
            const card = $("<my-card></my-card>");

            // add class card to enforce page specific styling
            card.addClass("card");
            

            //append child elements to card embedded with data fetched from database
            card.append(
              `<img slot="image"style="width: 100%;
            height: 200px;
            object-fit: cover;" src="${book["Image_URL_L"]}" alt="Great Gatsby" style="height: 10rem;">`
            );

            card.append(
              `<h2 class="title" data-bs-toggle="tooltip" data-bs-placement="top" title="${book["Book_Title"]}"  slot="title">${book["Book_Title"]}</h2>`
            );

            card.append(
              `<p  class='author' slot="author">${book["Book_Author"]}</p>`
            );
            card.append(
              `<p class='desc' slot="desc">This book is the bestseller with a very interesting story to tell ...</p>`
            );
            card.append(`<p class='price' slot="price">$${book["PRICE"]}</p>`);
           
              card.append(
              `<button slot="button" class='btn btn-outline-dark' " onclick={addToCart(event,${book["id"]})}>Add to Cart</button>`
            );
            
            
            //append or populate main element with newly embedded card
            $("#main").append(card);
          });
        })

      }
      function loadBooks(count) {
        return $.get(`../../api/category.php?page=home&offset=${count}`, function (data) {
        //   this is data array representing what will be fetched from database



 //since database echos an array of JSON format objects as string  and send it as data
//JSON.parse parses the string into an array of JSON objects
          const books = JSON.parse(data);
          
          //iterate over the array and for each object get data from object create a card
          //embed the data[url,name,ISBN,Book Title,Author] in the card html element 
          //append or populate the main element with the newly embedded card
          books.forEach((book) => {
            //create my card
            const card = $("<my-card></my-card>");

            // add class card to enforce page specific styling
            card.addClass("card");
            

            //append child elements to card embedded with data fetched from database
            card.append(
              `<img slot="image"style="width: 100%;
            height: 200px;
            object-fit: cover;" src="${book["Image_URL_L"]}" alt="Great Gatsby" style="height: 10rem;">`
            );

            card.append(
              `<h2 class="title" data-bs-toggle="tooltip" data-bs-placement="top" title="${book["Book_Title"]}"  slot="title">${book["Book_Title"]}</h2>`
            );

            card.append(
              `<p  class='author' slot="author">${book["Book_Author"]}</p>`
            );
            card.append(
              `<p class='desc' slot="desc">This book is the bestseller with a very interesting story to tell ...</p>`
            );
            card.append(`<p class='price' slot="price">$${book["PRICE"]}</p>`);
            card.append(
              `<button slot="button" class='btn btn-outline-dark' " onclick={addToCart(event,${book["id"]})}>Add to Cart</button>`
            );
            //append or populate main element with newly embedded card
            $("#main").append(card);
          });
        }).then(function () {
          //.then is used to make sure below code executes only after populating main elements with card


          
          //attach a flip function to cards
          $("#main .card").click(function () {
            //on click, first add flip class if without flip class and remove flip class if flip class present
            $(this).toggleClass("flip");
            

            //after toggling flip class conditionally add styles based on flip state
            if ($(this).hasClass("flip")) {
              //a card with flip class do not display author,price,button  but description
              $(this).find(".author").css({ display: "none" });
              $(this).find(".price").css({ display: "none" });
              $(this).find(".btn").css({ display: "none" });
              $(this).find(".desc").css({ display: "block" });
            } else {
               //a card without flip class do not display description but displays author and price and button
              $(this).find(".author").css({ display: "block" });
              $(this).find(".price").css({ display: "block" });
              $(this).find(".btn").css({ display: "block" });
              $(this).find(".desc").css({ display: "none" });
            }
          });
          //this is where the category button is attached to the function that creates a bootstrap modal element based on the modal styled above
          //then shows the modal
          $(".category").click(function(){
            new bootstrap.Modal($("#categorymodal")).show();
          });

          $(".more").click(function(){
            count+=20
            load(count);
          })
          $(".logout").click(function(){
            deleteCookie("user_id",1,1);
            deleteCookie("session_id",1,1);
            window.location.reload()
          })

          $(".login").click(function(){
            window.location.href='login.html'
          })
          
          if(getCookie("user_id")===""||getCookie("session_id"==="")){
            $(".user-nav").css({display:"none"})
            $(".no-session").css({display:"inline"})
          }
         
         
          $(".search").on('input',function(e){
            cards=document.querySelectorAll(".card")
           
            let title=""
            let author=""

          cards.forEach(card=>{
            
            title=card.getElementsByClassName("title")[0].innerText.toLowerCase()
            author=card.getElementsByClassName("author")[0].innerText.toLowerCase()
            h=e.target.value.toLowerCase()
    
            if(title.match(h)==null&&
            author.match(h)==null){
              card.style.display="none"
             
            }
            else{
              card.style.display="block"
            }
          })
          })

          
          
         


          //this is the mycommunities button when clicked sets the current window location to mycommunities.html
          $(".mycommunities").click(function(){
            window.location.href='mycommunities.html'
          });
          //this is the mybooks button when clicked sets the current window location to mybooks.html
          $(".mybooks").click(function(){
            window.location.href='mybooks.html'
          });
          //this is the cart button when clicked sets the current window location to cart.html'
          $(".cart").click(function(){
            window.location.href='cart.html'
          });
         

          var tooltipTriggerList =
        [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
        })

        });
      }
      function deleteCookie(cname, cvalue, exdays) {
            const d = new Date();
            d.setTime(d.getTime() - exdays * 24 * 60 * 60 * 1000);
            let expires = "expires=" + d.toUTCString();
            // document.cookie = cname + "=" + encodeURIComponent(cvalue) + ";" + expires + ";path=/";
            let temp=cname + "=" + cvalue + ";" + expires + ";path=/"
            console.log(temp)
            document.cookie =temp ;
        }

      function getCookie(cname){
        cname=cname+"="
        let cookie=decodeURIComponent(document.cookie).split(";")
        for(let i=0;i<cookie.length;i++){
          c=cookie[i]
          while(c.charAt(0)==" "){
            c=c.substring(1)
          }
          if(c.indexOf(cname)==0){
            return c.substring(cname.length,c.length)
          }
        }
        return ""
      }

//this is the add cart function attached to each card during the  loop for populating the main element with cards after fetching data from database
      function addToCart(event, bookID) {
        if(getCookie("user_id")!=""||getCookie("session_id")!=""){
        //initalize an empty array
        let books = [];
        //check localstorage for array of books
        if (localStorage.getItem("books")) {
          //if found parse the array as it is currently a string into real array
          books = JSON.parse(localStorage.getItem("books"));
        }
        //push the bookid passed as argument into books array
        books.push(bookID);
        //set the mdified array into locla storage again as string
        localStorage.setItem("books", JSON.stringify(books));

        //create new modal based on styled modal above and then show it
        new bootstrap.Modal($("#mymodal")).show();
      }else{
        alert("Login to add to cart")
      }
      }
      //this is like the entry point of script the main function- loadBooks is called only after document reloads
      $(document).ready(function () {

        loadBooks(0);
      });
    </script>
  </body>
</html>
